<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math 1530 Question Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#000000">
    <style>
        /* Dark theme styles */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Main container styles */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Question card styling */
        .card {
            background: #121212;
            color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(255,255,255,0.1);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        
        /* Grid layout for answer buttons */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        /* Answer button styling */
        .option-button {
            padding: 15px;
            min-height: 70px;
            font-size: 16px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .option-button:hover {
            background-color: #333333;
            transform: translateY(-2px);
        }
        
        .correct-answer {
            background-color: #1e4620 !important;
            color: white;
            border-color: #4CAF50;
        }
        
        .incorrect-answer {
            background-color: #4c1e1e !important;
            color: white;
            border-color: #f44336;
        }
        
        /* Button container */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Button styling */
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background-color: #0d47a1;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        .button:hover {
            background-color: #1565c0;
        }
        
        .button.secondary {
            background-color: #424242;
        }
        
        .button.secondary:hover {
            background-color: #616161;
        }
        
        /* Header styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        /* Stats styling */
        .stats {
            font-weight: bold;
            color: #e0e0e0;
        }
        
        /* Calculator steps styling */
        .calculator-steps {
            background-color: #1a1a1a;
            border-left: 4px solid #0d47a1;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 14px;
            color: #e0e0e0;
        }
        
        /* Hide elements */
        .hidden {
            display: none !important;
        }
        
        /* Streak counter */
        .streak-counter {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #ff7043;
            margin: 10px 0;
        }
        
        /* Back button */
        .back-button {
            text-decoration: none;
            display: inline-block;
            color: white;
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Headings */
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        h3 {
            color: #64b5f6;
            margin-top: 20px;
            margin-bottom: 5px;
        }
        
        /* Question text */
        #question-text {
            font-size: 18px;
            line-height: 1.5;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        /* Mascot styling */
        .mascot-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            height: 150px;
            position: relative;
        }
        
        #mascot {
            height: 150px;
            transition: transform 0.2s;
        }
        
        /* Rocket animation */
        @keyframes blast-off {
            0% { transform: translateY(0); }
            10% { transform: translateY(-10px); }
            30% { transform: translateY(-30px); }
            100% { transform: translateY(-500px); }
        }
        
        .blast-off {
            animation: blast-off 1.5s ease-in forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="stats" id="stats-label">
                <span>Score: 0 / 0</span>
                <button onclick="clearUsedQuestions()" class="button secondary" style="margin-left: 10px; font-size: 12px; padding: 5px 10px;">üîÑ New Questions</button>
            </div>
            <a href="{{ url_for('exams_page') }}" class="button back-button">‚Üê Back</a>
            </div>
        
        <div class="mascot-container">
            <img src="{{ url_for('static', filename='mascot_idle_1.png') }}" alt="Mascot" id="mascot">
        </div>
        
        <h1>
            {% if topic %}
                {{ topic }}
            {% elif exam %}
                {{ exam }} Practice
            {% else %}
                Final Exam Practice
            {% endif %}
        </h1>
        
        <div class="card">
            <div id="question-text">Which of the following represents the addition rule for probability?</div>
        </div>
        
        <div id="options-container" class="options-grid">
            <!-- Options will be added here dynamically -->
        </div>
        
        <div class="card hidden" id="feedback-card">
            <p id="feedback-text"></p>
            <div id="ti84-section">
                <h3>Calculator Steps:</h3>
                <div id="ti84-text" class="calculator-steps"></div>
            </div>
            
            <div class="navigation">
                <div></div> <!-- Spacer -->
                <button id="next-button" class="button">Next Question</button>
            </div>
        </div>
        
        <div class="card hidden" id="hint-card">
            <p id="hint-text"></p>
        </div>
        
        <div class="button-container">
            <button id="hint-button" class="button secondary">Hint</button>
            <button id="skip-button" class="button">Skip</button>
        </div>
        
        <div id="streak-counter" class="streak-counter"></div>
    </div>

    <script>
        // Complete question bank with all question types
        const questionBank = {
            // Question templates for each category
            templates: {
                // Exam 1 question types
                "Variable Types": [
                    {
                        question: "Which type of variable is a person's age?",
                        options: ["Categorical", "Quantitative Discrete", "Quantitative Continuous"],
                        correct: 2,
                        explanation: "Age is a quantitative continuous variable because it's measured and can take any value within a range.",
                        hint: "Think about whether the data is a measurement, a countable number, or a category.",
                        ti84: "This is a conceptual question that doesn't require a calculator."
                    },
                    {
                        question: "The number of students in a class is what type of variable?",
                        options: ["Categorical", "Quantitative Discrete", "Quantitative Continuous"],
                        correct: 1,
                        explanation: "The number of students is a quantitative discrete variable because it's a count that can only take whole number values.",
                        hint: "Can you have a fraction of this variable?",
                        ti84: "This is a conceptual question that doesn't require a calculator."
                    }
                ],
                
                // Exam 2 question types - Assignment 7: Basic Probability
                "Assignment 7: Basic Probability": [
                    {
                        question: "If P(A) = 0.3, P(B) = 0.4, and P(A‚à©B) = 0.1, what is P(A‚à™B)?",
                        options: ["0.5", "0.6", "0.7", "0.8"],
                        correct: 2,
                        explanation: "Using addition rule: P(A‚à™B) = P(A) + P(B) - P(A‚à©B) = 0.3 + 0.4 - 0.1 = 0.7",
                        hint: "Use the addition rule for probability: P(A‚à™B) = P(A) + P(B) - P(A‚à©B)",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR] to access home screen
2. Type: 0.3 + 0.4 - 0.1
3. Press [ENTER]
4. Result: 0.7

Formula: P(A‚à™B) = P(A) + P(B) - P(A‚à©B)`
                    },
                    {
                        question: "What is the complement of an event with probability 0.7?",
                        options: ["0.3", "0.7", "1.0", "0.0"],
                        correct: 0,
                        explanation: "Complement probability = 1 - P(A) = 1 - 0.7 = 0.3",
                        hint: "Remember: P(A') = 1 - P(A)",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: 1 - 0.7
3. Press [ENTER]
4. Result: 0.3

Formula: P(A') = 1 - P(A)`
                    },
                    {
                        question: "In a Venn diagram, what does the intersection A‚à©B represent?",
                        options: ["Only A occurs", "Only B occurs", "Both A and B occur", "Neither A nor B occurs"],
                        correct: 2,
                        explanation: "Intersection A‚à©B represents outcomes where both events A and B occur",
                        hint: "Think about what 'intersection' means in set theory",
                        ti84: "This is a conceptual question that doesn't require a calculator."
                    }
                ],

                // Assignment 8: Conditional Probability
                "Assignment 8: Conditional Probability": [
                    {
                        question: "If P(A) = 0.6 and P(B|A) = 0.4, what is P(A‚à©B)?",
                        options: ["0.2", "0.24", "0.36", "1.0"],
                        correct: 1,
                        explanation: "P(A‚à©B) = P(A) √ó P(B|A) = 0.6 √ó 0.4 = 0.24",
                        hint: "Use the multiplication rule: P(A‚à©B) = P(A) √ó P(B|A)",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: 0.6 √ó 0.4
3. Press [ENTER]
4. Result: 0.24

Formula: P(A‚à©B) = P(A) √ó P(B|A)`
                    },
                    {
                        question: "If P(A) = 0.5, P(B) = 0.3, and P(A‚à©B) = 0.15, are A and B independent?",
                        options: ["Yes", "No", "Cannot determine", "Depends on sample space"],
                        correct: 0,
                        explanation: "Check: P(A) √ó P(B) = 0.5 √ó 0.3 = 0.15 = P(A‚à©B), so they are independent",
                        hint: "Check if P(A) √ó P(B) equals P(A‚à©B)",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: 0.5 √ó 0.3
3. Press [ENTER]
4. Result: 0.15
5. Compare with P(A‚à©B) = 0.15

If P(A) √ó P(B) = P(A‚à©B), then independent`
                    }
                ],

                // Assignment 9: Binomial Distribution
                "Assignment 9: Binomial Distribution": [
                    {
                        question: "If you flip a fair coin 10 times, what is the probability of getting exactly 6 heads?",
                        options: ["0.21", "0.25", "0.38", "0.50"],
                        correct: 0,
                        explanation: "P(X=6) = C(10,6) √ó 0.5‚Å∂ √ó 0.5‚Å¥ ‚âà 0.2051 ‚âà 0.21",
                        hint: "Use binompdf(n, p, k) for exact probability",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (DISTR menu)
2. Press [0] for binompdf(
3. Type: binompdf(10, 0.5, 6)
4. Press [ENTER]
5. Result: ‚âà 0.2051

Formula: P(X=k) = C(n,k) √ó p^k √ó (1-p)^(n-k)`
                    },
                    {
                        question: "For binomial distribution with n=20, p=0.3, what is the expected value?",
                        options: ["6", "7", "8", "9"],
                        correct: 0,
                        explanation: "E(X) = n √ó p = 20 √ó 0.3 = 6",
                        hint: "Expected value = n √ó p",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: 20 √ó 0.3
3. Press [ENTER]
4. Result: 6

Formula: E(X) = n √ó p`
                    },
                    {
                        question: "For binomial distribution with n=20, p=0.3, what is the standard deviation?",
                        options: ["2.05", "2.45", "3.0", "4.2"],
                        correct: 1,
                        explanation: "SD(X) = ‚àö[n√óp√ó(1-p)] = ‚àö[20√ó0.3√ó0.7] = ‚àö4.2 ‚âà 2.45",
                        hint: "Standard deviation = ‚àö[n√óp√ó(1-p)]",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: ‚àö(20 √ó 0.3 √ó 0.7)
3. Press [ENTER]
4. Result: ‚âà 2.45

Formula: SD(X) = ‚àö[n√óp√ó(1-p)]`
                    }
                ],

                // Assignment 10: Normal Distribution
                "Assignment 10: Normal Distribution": [
                    {
                        question: "In N(100,15), what z-score corresponds to x=130?",
                        options: ["1.0", "2.0", "3.0", "4.0"],
                        correct: 1,
                        explanation: "z = (x - Œº)/œÉ = (130 - 100)/15 = 30/15 = 2.0",
                        hint: "z-score = (x - mean)/standard deviation",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: (130 - 100) √∑ 15
3. Press [ENTER]
4. Result: 2.0

Formula: z = (x - Œº)/œÉ`
                    },
                    {
                        question: "What percentage of values fall within Œº¬±2œÉ in a normal distribution?",
                        options: ["68%", "95%", "99.7%", "100%"],
                        correct: 1,
                        explanation: "Empirical rule: approximately 95% of values fall within Œº¬±2œÉ",
                        hint: "Remember the empirical rule: 68-95-99.7",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (DISTR menu)
2. Press [2] for normalcdf(
3. Type: normalcdf(Œº-2œÉ, Œº+2œÉ, Œº, œÉ)
4. For Œº=0, œÉ=1: normalcdf(-2, 2, 0, 1)
5. Result: ‚âà 0.9545 or 95.45%

Empirical Rule: 68-95-99.7`
                    },
                    {
                        question: "In a normal distribution, what percentage falls within Œº¬±1œÉ?",
                        options: ["50%", "68%", "95%", "99.7%"],
                        correct: 1,
                        explanation: "Empirical rule: approximately 68% of values fall within Œº¬±1œÉ",
                        hint: "Empirical rule: 68% within 1 standard deviation",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (DISTR menu)
2. Press [2] for normalcdf(
3. Type: normalcdf(-1, 1, 0, 1)
4. Press [ENTER]
5. Result: ‚âà 0.6827 or 68.27%

Empirical Rule: 68% within Œº¬±1œÉ`
                    }
                ],

                // Assignment 11: Sampling Distributions
                "Assignment 11: Sampling Distributions": [
                    {
                        question: "For sample size n=25 from population with œÉ=10, what is the standard error?",
                        options: ["0.4", "2.0", "4.0", "10.0"],
                        correct: 1,
                        explanation: "Standard Error = œÉ/‚àön = 10/‚àö25 = 10/5 = 2.0",
                        hint: "Standard error = population standard deviation / ‚àösample size",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: 10 √∑ ‚àö(25)
3. Press [ENTER]
4. Result: 2.0

Formula: Standard Error = œÉ/‚àön`
                    },
                    {
                        question: "What does the Central Limit Theorem state about sample means?",
                        options: [
                            "They are always normal",
                            "They approximate normal for large n",
                            "They equal population mean",
                            "They have zero variance"
                        ],
                        correct: 1,
                        explanation: "CLT: Sample means approximate normal distribution for large sample sizes",
                        hint: "CLT applies when sample size is large (typically n ‚â• 30)",
                        ti84: `TI-84 Calculator Steps:
1. This is a conceptual question
2. No calculator needed
3. Remember: CLT applies when n ‚â• 30

Key Point: CLT allows normal approximation for large samples`
                    },
                    {
                        question: "For sample proportion with n=100, p=0.4, what is the standard deviation?",
                        options: ["0.049", "0.24", "0.4", "0.6"],
                        correct: 0,
                        explanation: "SD = ‚àö[p(1-p)/n] = ‚àö[0.4√ó0.6/100] = ‚àö0.0024 ‚âà 0.049",
                        hint: "Standard deviation = ‚àö[p(1-p)/n]",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR]
2. Type: ‚àö(0.4 √ó 0.6 √∑ 100)
3. Press [ENTER]
4. Result: ‚âà 0.049

Formula: SD = ‚àö[p(1-p)/n]`
                    }
                ],
                
            },
            
            // Get a random question based on topic
            getQuestion: function(topic, examType) {
                let questionPool = [];
                
                // If specific topic is provided
                if (topic && this.templates[topic]) {
                    questionPool = this.templates[topic];
                } 
                // If exam type is provided
                else if (examType === "Exam 1") {
                    questionPool = [
                        ...this.templates["Variable Types"]
                    ];
                }
                else if (examType === "Exam 2") {
                    questionPool = [
                        ...this.templates["Assignment 7: Basic Probability"],
                        ...this.templates["Assignment 8: Conditional Probability"],
                        ...this.templates["Assignment 9: Binomial Distribution"],
                        ...this.templates["Assignment 10: Normal Distribution"],
                        ...this.templates["Assignment 11: Sampling Distributions"]
                    ];
                }
                // Random from all
                else {
                    const allQuestions = [
                        ...this.templates["Variable Types"],
                        ...this.templates["Assignment 7: Basic Probability"],
                        ...this.templates["Assignment 8: Conditional Probability"],
                        ...this.templates["Assignment 9: Binomial Distribution"],
                        ...this.templates["Assignment 10: Normal Distribution"],
                        ...this.templates["Assignment 11: Sampling Distributions"]
                    ];
                    questionPool = allQuestions;
                }
                
                // Get random question from pool
                const randomIndex = Math.floor(Math.random() * questionPool.length);
                return questionPool[randomIndex];
            }
        };
        
        // Main application logic
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedbackCard = document.getElementById('feedback-card');
            const feedbackText = document.getElementById('feedback-text');
            const ti84Text = document.getElementById('ti84-text');
            const nextButton = document.getElementById('next-button');
            const skipButton = document.getElementById('skip-button');
            const hintButton = document.getElementById('hint-button');
            const hintCard = document.getElementById('hint-card');
            const hintText = document.getElementById('hint-text');
            const statsLabel = document.getElementById('stats-label');
            const streakCounter = document.getElementById('streak-counter');
            const mascot = document.getElementById('mascot');
            
            // Mascot animation frames
            const mascotFrames = {
                idle: ['mascot_idle_1.png', 'mascot_idle_2.png'],
                correct: ['mascot_correct_1.png', 'mascot_correct_2.png', 'mascot_correct_3.png', 'mascot_correct_4.png'],
                incorrect: ['mascot_incorrect_1.png', 'mascot_incorrect_2.png', 'mascot_incorrect_3.png', 'mascot_incorrect_4.png']
            };
            
            // Mascot animation state
            let mascotInterval = null;
            let currentFrame = 0;
            let currentAnimation = 'idle';
            
            // Start mascot idle animation
            function startMascotAnimation() {
                if (mascotInterval) clearInterval(mascotInterval);
                
                // Reset
                currentFrame = 0;
                mascot.style.visibility = 'visible';
                mascot.classList.remove('blast-off');
                
                if (currentAnimation === 'idle') {
                    mascotInterval = setInterval(() => {
                        currentFrame = (currentFrame + 1) % mascotFrames.idle.length;
                        mascot.src = `./static/${mascotFrames.idle[currentFrame]}`;
                    }, 500);
                }
                else if (currentAnimation === 'correct') {
                    // Spaceship animation
                    mascot.src = `./static/mascot_correct_1.png`;
                    mascot.classList.add('blast-off');
                }
                else if (currentAnimation === 'incorrect') {
                    let frame = 0;
                    mascotInterval = setInterval(() => {
                        if (frame >= mascotFrames.incorrect.length) {
                            clearInterval(mascotInterval);
                            mascot.style.visibility = 'hidden';
                            return;
                        }
                        mascot.src = `./static/${mascotFrames.incorrect[frame]}`;
                        frame++;
                    }, 150);
                }
            }
            
            // State variables
            let currentQuestion = null;
            let score = 0;
            let total = 0;
            let streak = 0;
            let multiplier = 1;
            
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const topic = urlParams.get('topic');
            const examType = urlParams.get('exam');
            
            // Get and display a new question
            function getQuestion() {
                // Reset UI state
                feedbackCard.classList.add('hidden');
                hintCard.classList.add('hidden');
                
                // Reset mascot
                currentAnimation = 'idle';
                startMascotAnimation();
                
                // Get new question
                currentQuestion = questionBank.getQuestion(topic, examType);
                
                // Display the question
                questionText.textContent = currentQuestion.question;
                optionsContainer.innerHTML = '';
                
                // Create option buttons in a grid layout
                currentQuestion.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option;
                    button.dataset.index = index;
                    button.addEventListener('click', checkAnswer);
                    optionsContainer.appendChild(button);
                });
            }
            
            // Check the selected answer
            function checkAnswer(event) {
                const selectedIndex = parseInt(event.target.dataset.index);
                const isCorrect = selectedIndex === currentQuestion.correct;
                
                // Disable all buttons
                const buttons = document.querySelectorAll('.option-button');
                buttons.forEach(button => {
                    button.disabled = true;
                    
                    // Highlight correct and incorrect answers
                    const index = parseInt(button.dataset.index);
                    if (index === currentQuestion.correct) {
                        button.classList.add('correct-answer');
                    } else if (index === selectedIndex) {
                        button.classList.add('incorrect-answer');
                    }
                });
                
                // Show feedback
                feedbackCard.classList.remove('hidden');
                feedbackText.textContent = currentQuestion.explanation;
                ti84Text.innerHTML = currentQuestion.ti84;
                
                // Update stats
                if (isCorrect) {
                    score += 1 * multiplier;
                    streak += 1;
                    multiplier = Math.min(5, streak > 3 ? Math.floor(streak / 3) : 1);
                    currentAnimation = 'correct'; // Rocket animation
                } else {
                    streak = 0;
                    multiplier = 1;
                    currentAnimation = 'incorrect';
                }
                total += 1;
                
                // Update mascot animation
                startMascotAnimation();
                
                // Update UI
                statsLabel.textContent = `Score: ${score} / ${total}`;
                streakCounter.textContent = streak > 0 ? `${streak} üî• (${multiplier}x)` : '';
            }
            
            // Event Listeners
            nextButton.addEventListener('click', getQuestion);
            skipButton.addEventListener('click', getQuestion);
            
            hintButton.addEventListener('click', () => {
                if (currentQuestion && currentQuestion.hint) {
                    hintCard.classList.toggle('hidden');
                    hintText.textContent = currentQuestion.hint;
                }
            });
            
            // Start with initial question and animation
            startMascotAnimation();
            getQuestion();
        });
    </script>
</body>
</html>

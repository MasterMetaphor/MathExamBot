<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math 1530 Question Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#000000">
    <style>
        /* Dark theme styles */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* Main container styles */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Question card styling */
        .card {
            background: #121212;
            color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(255,255,255,0.1);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        
        /* Grid layout for answer buttons */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        /* Answer button styling */
        .option-button {
            padding: 15px;
            min-height: 70px;
            font-size: 16px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #1a1a1a;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .option-button:hover {
            background-color: #333333;
            transform: translateY(-2px);
        }
        
        .correct-answer {
            background-color: #1e4620 !important;
            color: white;
            border-color: #4CAF50;
        }
        
        .incorrect-answer {
            background-color: #4c1e1e !important;
            color: white;
            border-color: #f44336;
        }
        
        /* Button container */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Button styling */
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background-color: #0d47a1;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        .button:hover {
            background-color: #1565c0;
        }
        
        .button.secondary {
            background-color: #424242;
        }
        
        .button.secondary:hover {
            background-color: #616161;
        }
        
        /* Header styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        /* Stats styling */
        .stats {
            font-weight: bold;
            color: #e0e0e0;
        }
        
        /* Calculator steps styling */
        .calculator-steps {
            background-color: #1a1a1a;
            border-left: 4px solid #0d47a1;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 14px;
            color: #e0e0e0;
        }
        
        /* Hide elements */
        .hidden {
            display: none !important;
        }
        
        /* Streak counter */
        .streak-counter {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #ff7043;
            margin: 10px 0;
        }
        
        /* Back button */
        .back-button {
            text-decoration: none;
            display: inline-block;
            color: white;
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Headings */
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        h3 {
            color: #64b5f6;
            margin-top: 20px;
            margin-bottom: 5px;
        }
        
        /* Question text */
        #question-text {
            font-size: 18px;
            line-height: 1.5;
            margin-bottom: 20px;
            color: #ffffff;
        }
        
        /* Mascot styling */
        .mascot-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            height: 150px;
            position: relative;
        }
        
        #mascot {
            height: 150px;
            transition: transform 0.2s;
        }
        
        /* Rocket animation */
        @keyframes blast-off {
            0% { transform: translateY(0); }
            10% { transform: translateY(-10px); }
            30% { transform: translateY(-30px); }
            100% { transform: translateY(-500px); }
        }
        
        .blast-off {
            animation: blast-off 1.5s ease-in forwards;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="stats" id="stats-label">
                <span>Score: 0 / 0</span>
                <button onclick="clearUsedQuestions()" class="button secondary" style="margin-left: 10px; font-size: 12px; padding: 5px 10px;">üîÑ New Questions</button>
            </div>
            <a href="{{ url_for('exams_page') }}" class="button back-button">‚Üê Back</a>
            </div>
        
        <div class="mascot-container">
            <img src="{{ url_for('static', filename='mascot_idle_1.png') }}" alt="Mascot" id="mascot">
        </div>
        
        <h1>
            {% if topic %}
                {{ topic }}
            {% elif exam %}
                {{ exam }} Practice
            {% else %}
                Final Exam Practice
            {% endif %}
        </h1>
        
        <div class="card">
            <div id="question-text">Which of the following represents the addition rule for probability?</div>
        </div>
        
        <div id="options-container" class="options-grid">
            <!-- Options will be added here dynamically -->
        </div>
        
        <div class="card hidden" id="feedback-card">
            <p id="feedback-text"></p>
            <div id="ti84-section">
                <h3>Calculator Steps:</h3>
                <div id="ti84-text" class="calculator-steps"></div>
            </div>
            
            <div class="navigation">
                <div></div> <!-- Spacer -->
                <button id="next-button" class="button">Next Question</button>
            </div>
        </div>
        
        <div class="card hidden" id="hint-card">
            <p id="hint-text"></p>
        </div>
        
        <div class="button-container">
            <button id="hint-button" class="button secondary">Hint</button>
            <button id="skip-button" class="button">Skip</button>
        </div>
        
        <div id="streak-counter" class="streak-counter"></div>
    </div>

    <script src="{{ url_for('static', filename='question-bank.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Use external question bank
        const questionBank = new QuestionBank();
            // Question templates for each category
            templates: {
                // Exam 1 question types
                "Variable Types": [
                    {
                        question: "Which type of variable is a person's age?",
                        options: ["Categorical", "Quantitative Discrete", "Quantitative Continuous"],
                        correct: 2,
                        explanation: "Age is a quantitative continuous variable because it's measured and can take any value within a range.",
                        hint: "Think about whether the data is a measurement, a countable number, or a category.",
                        ti84: "This is a conceptual question that doesn't require a calculator."
                    },
                    {
                        question: "The number of students in a class is what type of variable?",
                        options: ["Categorical", "Quantitative Discrete", "Quantitative Continuous"],
                        correct: 1,
                        explanation: "The number of students is a quantitative discrete variable because it's a count that can only take whole number values.",
                        hint: "Can you have a fraction of this variable?",
                        ti84: "This is a conceptual question that doesn't require a calculator."
                    }
                ],
                
                // Exam 2 question types
                "Probability Basics": [
                    {
                        question: "If P(A) = 0.3, P(B) = 0.4, and P(A‚à©B) = 0.1, what is P(A‚à™B)?",
                        options: ["0.5", "0.6", "0.7", "0.8"],
                        correct: 2,
                        explanation: "Using the addition rule, P(A‚à™B) = P(A) + P(B) - P(A‚à©B) = 0.3 + 0.4 - 0.1 = 0.7",
                        hint: "Use the addition rule for probability: P(A‚à™B) = P(A) + P(B) - P(A‚à©B).",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR] to access the home screen
2. Type 0.3 [+] 0.4 [-] 0.1
3. Press [ENTER]
4. Result: 0.7

For addition rule: P(A‚à™B) = P(A) + P(B) - P(A‚à©B)
For complements: P(A') = 1 - P(A)

Example: If P(A) = 0.3, P(B) = 0.4, P(A‚à©B) = 0.1
To find P(A‚à™B): 0.3 + 0.4 - 0.1 = 0.7`
                    },
                    {
                        question: "If P(A) = 0.6 and P(B|A) = 0.4, what is P(A‚à©B)?",
                        options: ["0.2", "0.24", "0.36", "1.0"],
                        correct: 1,
                        explanation: "Using the formula P(A‚à©B) = P(A) √ó P(B|A) = 0.6 √ó 0.4 = 0.24",
                        hint: "Use the multiplication rule for conditional probability.",
                        ti84: `TI-84 Calculator Steps:
1. Press [CLEAR] to access the home screen
2. Type 0.6 [√ó] 0.4
   (Note: [√ó] is the multiplication key, usually next to [7])
3. Press [ENTER]
4. Result: 0.24

For conditional probability: P(A‚à©B) = P(A) √ó P(B|A)

Example: If P(A) = 0.6, P(B|A) = 0.4
To find P(A‚à©B): 0.6 √ó 0.4 = 0.24`
                    }
                ],
                
                "Normal Distributions": [
                    {
                        question: "In a normal distribution with mean 70 and standard deviation 5, approximately what percentage of values lie between 65 and 75?",
                        options: ["38%", "50%", "68%", "95%"],
                        correct: 2,
                        explanation: "The range 65 to 75 represents Œº¬±1œÉ (70¬±5). According to the empirical rule, approximately 68% of values fall within 1 standard deviation of the mean.",
                        hint: "Apply the empirical rule for normal distributions.",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (you'll see DISTR at the top)
2. Press [2] or use arrow keys to highlight 2:normalcdf( then press [ENTER]
3. Type 65 [,] 75 [,] 70 [,] 5 
4. Press [ENTER]
5. Result: approximately 0.6827 or about 68.27%

Note: The empirical rule states that approximately 68% of data falls within 1 standard deviation of the mean in a normal distribution.`
                    },
                    {
                        question: "For a normal distribution with mean 100 and standard deviation 15, what is the probability that a randomly selected value is greater than 130?",
                        options: ["0.0228", "0.0668", "0.1587", "0.9772"],
                        correct: 0,
                        explanation: "We need to find P(X > 130) where X ~ N(100, 15). Using the normal CDF, this equals 0.0228 or about 2.28%.",
                        hint: "Use the normalcdf function with the appropriate bounds.",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (you'll see DISTR at the top)
2. Press [2] or use arrow keys to highlight 2:normalcdf( then press [ENTER]
3. Type 130 [,] 1 [EE] 99 [,] 100 [,] 15
   (Note: [EE] is found by pressing [2nd] ‚Üí [,])
4. Press [ENTER]
5. Result: approximately 0.0228 or about 2.28%

Note: 1E99 is used as the upper bound to represent infinity.`
                    }
                ],
                
                "Binomial Distribution": [
                    {
                        question: "If you flip a fair coin 10 times, what is the probability of getting exactly 6 heads?",
                        options: ["0.21", "0.25", "0.38", "0.50"],
                        correct: 0,
                        explanation: "This follows a binomial distribution with n=10, p=0.5. P(X=6) = 10C6 √ó 0.5^6 √ó 0.5^4 ‚âà 0.21",
                        hint: "Use the binomial probability formula: P(X=k) = nCk √ó p^k √ó (1-p)^(n-k)",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (you'll see DISTR at the top)
2. Press [0] or use arrow keys to highlight 0:binompdf( then press [ENTER]
3. Type 10 [,] 0.5 [,] 6
4. Press [ENTER]
5. Result: approximately 0.2051 or about 21%

Formula: P(X=k) = nCk √ó p^k √ó (1-p)^(n-k)
Where n=10, p=0.5, k=6`
                    },
                    {
                        question: "If the probability of a defective product is 0.05, and 20 products are randomly selected, what is the probability of finding at most 2 defective products?",
                        options: ["0.88", "0.64", "0.92", "0.98"],
                        correct: 0,
                        explanation: "This follows a binomial distribution with n=20, p=0.05. P(X ‚â§ 2) = P(X=0) + P(X=1) + P(X=2) ‚âà 0.88",
                        hint: "Use the binomial cumulative distribution function for X ‚â§ 2.",
                        ti84: `TI-84 Calculator Steps:
1. Press [2nd] ‚Üí [VARS] (you'll see DISTR at the top)
2. Press [1] or use arrow keys to highlight 1:binomcdf( then press [ENTER]
3. Type 20 [,] 0.05 [,] 2
4. Press [ENTER]
5. Result: approximately 0.8798 or about 88%

This calculates the cumulative probability P(X=0) + P(X=1) + P(X=2)`
                    }
                ]
            },
            
            // Get a random question based on topic
            getQuestion: function(topic, examType) {
                let questionPool = [];
                
                // If specific topic is provided
                if (topic && this.templates[topic]) {
                    questionPool = this.templates[topic];
                } 
                // If exam type is provided
                else if (examType === "Exam 1") {
                    questionPool = [
                        ...this.templates["Variable Types"]
                    ];
                }
                else if (examType === "Exam 2") {
                    questionPool = [
                        ...this.templates["Probability Basics"],
                        ...this.templates["Normal Distributions"],
                        ...this.templates["Binomial Distribution"]
                    ];
                }
                // Random from all
                else {
                    const allQuestions = [
                        ...this.templates["Variable Types"],
                        ...this.templates["Probability Basics"], 
                        ...this.templates["Normal Distributions"],
                        ...this.templates["Binomial Distribution"]
                    ];
                    questionPool = allQuestions;
                }
                
                // Get random question from pool
                const randomIndex = Math.floor(Math.random() * questionPool.length);
                return questionPool[randomIndex];
            }
        };
        
        // Main application logic
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedbackCard = document.getElementById('feedback-card');
            const feedbackText = document.getElementById('feedback-text');
            const ti84Text = document.getElementById('ti84-text');
            const nextButton = document.getElementById('next-button');
            const skipButton = document.getElementById('skip-button');
            const hintButton = document.getElementById('hint-button');
            const hintCard = document.getElementById('hint-card');
            const hintText = document.getElementById('hint-text');
            const statsLabel = document.getElementById('stats-label');
            const streakCounter = document.getElementById('streak-counter');
            const mascot = document.getElementById('mascot');
            
            // Mascot animation frames
            const mascotFrames = {
                idle: ['mascot_idle_1.png', 'mascot_idle_2.png'],
                correct: ['mascot_correct_1.png', 'mascot_correct_2.png', 'mascot_correct_3.png', 'mascot_correct_4.png'],
                incorrect: ['mascot_incorrect_1.png', 'mascot_incorrect_2.png', 'mascot_incorrect_3.png', 'mascot_incorrect_4.png']
            };
            
            // Mascot animation state
            let mascotInterval = null;
            let currentFrame = 0;
            let currentAnimation = 'idle';
            
            // Start mascot idle animation
            function startMascotAnimation() {
                if (mascotInterval) clearInterval(mascotInterval);
                
                // Reset
                currentFrame = 0;
                mascot.style.visibility = 'visible';
                mascot.classList.remove('blast-off');
                
                if (currentAnimation === 'idle') {
                    mascotInterval = setInterval(() => {
                        currentFrame = (currentFrame + 1) % mascotFrames.idle.length;
                        mascot.src = `./static/${mascotFrames.idle[currentFrame]}`;
                    }, 500);
                }
                else if (currentAnimation === 'correct') {
                    // Spaceship animation
                    mascot.src = `./static/mascot_correct_1.png`;
                    mascot.classList.add('blast-off');
                }
                else if (currentAnimation === 'incorrect') {
                    let frame = 0;
                    mascotInterval = setInterval(() => {
                        if (frame >= mascotFrames.incorrect.length) {
                            clearInterval(mascotInterval);
                            mascot.style.visibility = 'hidden';
                            return;
                        }
                        mascot.src = `./static/${mascotFrames.incorrect[frame]}`;
                        frame++;
                    }, 150);
                }
            }
            
            // State variables
            let currentQuestion = null;
            let score = 0;
            let total = 0;
            let streak = 0;
            let multiplier = 1;
            
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const topic = urlParams.get('topic');
            const examType = urlParams.get('exam');
            
            // Get and display a new question
            function getQuestion() {
                // Reset UI state
                feedbackCard.classList.add('hidden');
                hintCard.classList.add('hidden');
                
                // Reset mascot
                currentAnimation = 'idle';
                startMascotAnimation();
                
                // Get new question
                currentQuestion = questionBank.getQuestion(topic, examType);
                
                // Display the question
                questionText.textContent = currentQuestion.question;
                optionsContainer.innerHTML = '';
                
                // Create option buttons in a grid layout
                currentQuestion.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option;
                    button.dataset.index = index;
                    button.addEventListener('click', checkAnswer);
                    optionsContainer.appendChild(button);
                });
            }
            
            // Check the selected answer
            function checkAnswer(event) {
                const selectedIndex = parseInt(event.target.dataset.index);
                const isCorrect = selectedIndex === currentQuestion.correct;
                
                // Disable all buttons
                const buttons = document.querySelectorAll('.option-button');
                buttons.forEach(button => {
                    button.disabled = true;
                    
                    // Highlight correct and incorrect answers
                    const index = parseInt(button.dataset.index);
                    if (index === currentQuestion.correct) {
                        button.classList.add('correct-answer');
                    } else if (index === selectedIndex) {
                        button.classList.add('incorrect-answer');
                    }
                });
                
                // Show feedback
                feedbackCard.classList.remove('hidden');
                feedbackText.textContent = currentQuestion.explanation;
                ti84Text.innerHTML = currentQuestion.ti84;
                
                // Update stats
                if (isCorrect) {
                    score += 1 * multiplier;
                    streak += 1;
                    multiplier = Math.min(5, streak > 3 ? Math.floor(streak / 3) : 1);
                    currentAnimation = 'correct'; // Rocket animation
                } else {
                    streak = 0;
                    multiplier = 1;
                    currentAnimation = 'incorrect';
                }
                total += 1;
                
                // Update mascot animation
                startMascotAnimation();
                
                // Update UI
                statsLabel.textContent = `Score: ${score} / ${total}`;
                streakCounter.textContent = streak > 0 ? `${streak} üî• (${multiplier}x)` : '';
            }
            
            // Event Listeners
            nextButton.addEventListener('click', getQuestion);
            skipButton.addEventListener('click', getQuestion);
            
            hintButton.addEventListener('click', () => {
                if (currentQuestion && currentQuestion.hint) {
                    hintCard.classList.toggle('hidden');
                    hintText.textContent = currentQuestion.hint;
                }
            });
            
            // Start with initial question and animation
            startMascotAnimation();
            getQuestion();
        });
    </script>
</body>
</html>
